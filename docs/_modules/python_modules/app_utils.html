
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>python_modules.app_utils &#8212; Cinnamon Tools  documentation</title>
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/cinnamon-logo.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Cinnamon Tools  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for python_modules.app_utils</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Module with utility functions and classes.</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">Ansi : object</span>
<span class="sd">    :any:`ANSIColors` class initialization.</span>
<span class="sd">base_temp_folder : str</span>
<span class="sd">    Path to a temporary folder.</span>
<span class="sd">BASH_COMPLETION_LOADER_CONTENT : str</span>
<span class="sd">    Bash completions loader script.</span>
<span class="sd">bash_completions_step1 : str</span>
<span class="sd">    Bash completions creation message. Step 1.</span>
<span class="sd">bash_completions_step2 : str</span>
<span class="sd">    Bash completions creation message. Step 2.</span>
<span class="sd">domain_storage_file : str</span>
<span class="sd">    Path to the file were the domain name for xlets is stored.</span>
<span class="sd">env : dict</span>
<span class="sd">    Copy of the system&#39;s environment to be passed to Popen.</span>
<span class="sd">existent_xlet_destination_msg : str</span>
<span class="sd">    Message to display when creating a new xlet and that xlet already exists.</span>
<span class="sd">extra_common_files : list</span>
<span class="sd">    List of files common to all xlets.</span>
<span class="sd">HOME : str</span>
<span class="sd">    Path to the current user home folder.</span>
<span class="sd">missing_domain_msg : str</span>
<span class="sd">    Message to display when the domain name isn&#39;t specified at xlet build time.</span>
<span class="sd">missing_theme_name_msg : str</span>
<span class="sd">    Message to display when the theme name isn&#39;t specified at theme build time.</span>
<span class="sd">readme_list_item_template : str</span>
<span class="sd">    Template string to generate help pages list items.</span>
<span class="sd">repo_pages_url : str</span>
<span class="sd">    URL to the repository hosted web pages.</span>
<span class="sd">repo_url : str</span>
<span class="sd">    The repository URL.</span>
<span class="sd">root_folder : str</span>
<span class="sd">    The main folder containing the application. All commands must be executed from this location</span>
<span class="sd">    without exceptions.</span>
<span class="sd">theme_name_storage_file : str</span>
<span class="sd">    Path to the file were the theme name for xlets is stored.</span>
<span class="sd">xlet_dir_ignored_patterns : list</span>
<span class="sd">    List of patterns to ignore while copying files on xlet build time.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="k">import</span> <span class="n">copy2</span><span class="p">,</span> <span class="n">get_terminal_size</span><span class="p">,</span> <span class="n">copytree</span><span class="p">,</span> <span class="n">ignore_patterns</span><span class="p">,</span> <span class="n">rmtree</span><span class="p">,</span> <span class="n">which</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">call</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">run</span>


<div class="viewcode-block" id="ANSIColors"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ANSIColors">[docs]</a><span class="k">class</span> <span class="nc">ANSIColors</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Class to colorize terminal output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ANSIColors.ERROR"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ANSIColors.ERROR">[docs]</a>    <span class="k">def</span> <span class="nf">ERROR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Red color that symbolizes error.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The string that will be &quot;colorized&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String surrounded by ANSI codes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[38;5;166;1m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span></div>

<div class="viewcode-block" id="ANSIColors.INFO"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ANSIColors.INFO">[docs]</a>    <span class="k">def</span> <span class="nf">INFO</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;No color, just bold text.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The string that will be &quot;colorized&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String surrounded by ANSI codes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span></div>

<div class="viewcode-block" id="ANSIColors.WARNING"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ANSIColors.WARNING">[docs]</a>    <span class="k">def</span> <span class="nf">WARNING</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yellow color that symbolizes warning.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The string that will be &quot;colorized&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String surrounded by ANSI codes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[38;5;220;1m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span></div>

<div class="viewcode-block" id="ANSIColors.SUCCESS"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ANSIColors.SUCCESS">[docs]</a>    <span class="k">def</span> <span class="nf">SUCCESS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Green color that symbolizes success.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The string that will be &quot;colorized&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String surrounded by ANSI codes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[38;5;77;1m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span></div>

<div class="viewcode-block" id="ANSIColors.PURPLE"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ANSIColors.PURPLE">[docs]</a>    <span class="k">def</span> <span class="nf">PURPLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Purple color.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The string that will be &quot;colorized&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            String surrounded by ANSI codes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[38;5;164;1m&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span></div></div>


<span class="n">Ansi</span> <span class="o">=</span> <span class="n">ANSIColors</span><span class="p">()</span>


<div class="viewcode-block" id="ExceptionWhitoutTraceBack"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ExceptionWhitoutTraceBack">[docs]</a><span class="k">class</span> <span class="nc">ExceptionWhitoutTraceBack</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an exception without a traceback.</span>

<span class="sd">    Only used when the traceback isn&#39;t important and the message is clear, to</span>
<span class="sd">    the point, and highlighted in red.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    args : tuple</span>
<span class="sd">        Arguments.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Based on an answer from a `StackOverflow question &lt;https://stackoverflow.com/a/41414413&gt;`__.</span>
<span class="sd">    Stripped the line number report from the original class because is not needed for my usage case.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            Message that the exception should display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This is an evil spawn that I don&#39;t freaking understand!!!</span>
        <span class="c1"># It works as intended for now, so moving on.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0.__name__}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">msg</span><span class="p">)),</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="ExceptionWhitoutTraceBackWarning"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ExceptionWhitoutTraceBackWarning">[docs]</a><span class="k">class</span> <span class="nc">ExceptionWhitoutTraceBackWarning</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an exception without a traceback nor an exit errror.</span>

<span class="sd">    Only used when the traceback isn&#39;t important and the message is clear, to</span>
<span class="sd">    the point, and highlighted in red.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    args : tuple</span>
<span class="sd">        Arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            Message that the exception should display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This is an evil spawn that I don&#39;t freaking understand!!!</span>
        <span class="c1"># It works as intended for now, so moving on.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0.__name__}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">msg</span><span class="p">)),</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="BadExecutionLocation"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.BadExecutionLocation">[docs]</a><span class="k">class</span> <span class="nc">BadExecutionLocation</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBack</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BadExecutionLocation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;All commands must be launched from the application&#39;s root directory!!!&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str, optional</span>
<span class="sd">            Message that the exception should display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BadExecutionLocation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="WrongPythonVersion"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.WrongPythonVersion">[docs]</a><span class="k">class</span> <span class="nc">WrongPythonVersion</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBack</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;WrongPythonVersion</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Minimum Python version supported: 3.5&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str, optional</span>
<span class="sd">            Message that the exception should display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WrongPythonVersion</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="MissingCommand"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.MissingCommand">[docs]</a><span class="k">class</span> <span class="nc">MissingCommand</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBack</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MissingCommand</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="MissingDependencyModule"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.MissingDependencyModule">[docs]</a><span class="k">class</span> <span class="nc">MissingDependencyModule</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBack</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MissingDependencyModule</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ExistentLocation"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ExistentLocation">[docs]</a><span class="k">class</span> <span class="nc">ExistentLocation</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBack</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ExistentLocation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KeyboardInterruption"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.KeyboardInterruption">[docs]</a><span class="k">class</span> <span class="nc">KeyboardInterruption</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBackWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;KeyboardInterruption</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Operation aborted.&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str, optional</span>
<span class="sd">            Message that the exception should display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">KeyboardInterruption</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="MissingRequiredFile"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.MissingRequiredFile">[docs]</a><span class="k">class</span> <span class="nc">MissingRequiredFile</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBackWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MissingRequiredFile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="InvalidDestination"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.InvalidDestination">[docs]</a><span class="k">class</span> <span class="nc">InvalidDestination</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBackWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;InvalidDestination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="OperationAborted"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.OperationAborted">[docs]</a><span class="k">class</span> <span class="nc">OperationAborted</span><span class="p">(</span><span class="n">ExceptionWhitoutTraceBackWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;OperationAborted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">OSError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ValidationError"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.ValidationError">[docs]</a><span class="k">class</span> <span class="nc">ValidationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised for validation errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="n">HOME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span>


<span class="n">bash_completions_step1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Bash completions creation. Step 1.</span>

<span class="s2">The file </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">will be created.</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="n">bash_completions_step2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Bash completions creation. Step 2.</span>

<span class="s2">The file </span><span class="si">{0}</span><span class="s2">/.bash_completion will be created if it doesn&#39;t exists.</span>

<span class="s2">Or the pertinent code to load bash completions from the .bash_completion.d</span>
<span class="s2">directory will be appended to the existent file.</span>

<span class="s2">The </span><span class="si">{0}</span><span class="s2">/.bash_completion file needs to be manually sourced in your shell&#39;s</span>
<span class="s2">configuration file (.bashrc, .zshrc, etc.).</span>

<span class="s2">The following is the content that will be appended to the</span>
<span class="si">{0}</span><span class="s2">/.bash_completion file.</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="n">root_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="o">*</span><span class="p">([</span><span class="s2">&quot;..&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))))))</span>

<span class="n">repo_url</span> <span class="o">=</span> <span class="s2">&quot;https://gitlab.com/Odyseus/CinnamonTools&quot;</span>

<span class="n">repo_pages_url</span> <span class="o">=</span> <span class="s2">&quot;https://odyseus.gitlab.io/CinnamonTools&quot;</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">domain_storage_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;domain_name&quot;</span><span class="p">)</span>

<span class="n">theme_name_storage_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;theme_name&quot;</span><span class="p">)</span>

<span class="n">base_temp_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;CinnamonToolsTemp&quot;</span><span class="p">)</span>


<span class="n">missing_domain_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;DomainNameNotSet:</span>
<span class="s2">The command line option `--domain=&lt;domain&gt;` should be used to define a domain</span>
<span class="s2">name for use when building xlets.</span>
<span class="s2">Or a file named &quot;domain_name&quot; should be created at the root of the repository</span>
<span class="s2">whose only content should be the desired domain name.</span>
<span class="s2">The `--domain` command line option has precedence over the domain name found</span>
<span class="s2">inside the &quot;domain_name&quot; file.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">missing_theme_name_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;ThemeNameNotSet:</span>
<span class="s2">The command line option `--theme-name=&lt;name&gt;` should be used to define a theme</span>
<span class="s2">name for use when building themes.</span>
<span class="s2">Or a file named &quot;theme_name&quot; should be created at the root of the repository</span>
<span class="s2">whose only content should be the desired theme name.</span>
<span class="s2">The `--theme-name` command line option has precedence over the theme name found</span>
<span class="s2">inside the &quot;theme_name&quot; file.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">existent_xlet_destination_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Destination folder exists!!!</span>
<span class="si">{path}</span><span class="s2"></span>
<span class="s2">Choosing to proceed will completely remove the existent folder.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">xlet_dir_ignored_patterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;__pycache__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__data__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;*~&quot;</span><span class="p">,</span>
    <span class="s2">&quot;*.bak&quot;</span><span class="p">,</span>
    <span class="s2">&quot;*.pyc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;z_config.py&quot;</span><span class="p">,</span>
    <span class="s2">&quot;z_create_localized_help.py&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">extra_common_files</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s2">&quot;source_path&quot;</span><span class="p">:</span> <span class="n">root_folder</span><span class="p">,</span>
    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;LICENSE.md&quot;</span><span class="p">,</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;source_path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;python_scripts&quot;</span><span class="p">),</span>
    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;helper.py&quot;</span><span class="p">,</span>
<span class="p">}]</span>

<span class="n">readme_list_item_template</span> <span class="o">=</span> <span class="s2">&quot;- [</span><span class="si">{xlet_name}</span><span class="s2">](</span><span class="si">%s</span><span class="s2">/_static/xlets_help_pages/</span><span class="si">{xlet_slug}</span><span class="s2">/index.html)&quot;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="n">repo_pages_url</span><span class="p">)</span>


<div class="viewcode-block" id="LogSystem"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem">[docs]</a><span class="k">class</span> <span class="nc">LogSystem</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Manage the log system.</span>

<span class="sd">    A very simple log system.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        Display message in terminal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;backup.log&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            Log file name or path to a file.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Display message in terminal.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Raise if the log file destination isn&#39;t a folder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dirname</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">dirname</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Destination &lt;</span><span class="si">%s</span><span class="s2">&gt; should be a directory!!!&quot;</span> <span class="o">%</span> <span class="n">dirname</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<div class="viewcode-block" id="LogSystem.debug"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with &quot;DEBUG&quot; level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; msg</span>
<span class="sd">        term : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; term</span>
<span class="sd">        date : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogSystem.info"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with &quot;INFO&quot; level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; msg</span>
<span class="sd">        term : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; term</span>
<span class="sd">        date : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogSystem.success"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.success">[docs]</a>    <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with &quot;INFO&quot; level but with green color on screen.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; msg</span>
<span class="sd">        term : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; term</span>
<span class="sd">        date : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogSystem.warning"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.warning">[docs]</a>    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with &quot;WARNING&quot; level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; msg</span>
<span class="sd">        term : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; term</span>
<span class="sd">        date : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogSystem.error"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with &quot;ERROR&quot; level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; msg</span>
<span class="sd">        term : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; term</span>
<span class="sd">        date : bool, optional</span>
<span class="sd">            See :any:`LogSystem.update_log` &gt; date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span></div>

<div class="viewcode-block" id="LogSystem.get_now"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.get_now">[docs]</a>    <span class="k">def</span> <span class="nf">get_now</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get current time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Date formatted with milliseconds instead of microseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">micro_to_milli</span><span class="p">(</span><span class="n">get_date_time</span><span class="p">())</span></div>

<div class="viewcode-block" id="LogSystem.update_log"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.LogSystem.update_log">[docs]</a>    <span class="k">def</span> <span class="nf">update_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">term</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do the actual logging.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : str</span>
<span class="sd">            The message to log.</span>
<span class="sd">        type : str, optional</span>
<span class="sd">            The logging level (DEBUG, INFO, WARNING or ERROR).</span>
<span class="sd">        term : bool, optional</span>
<span class="sd">            Display message in terminal. If set to False, and even with versbose set to True,</span>
<span class="sd">            the message will not be printed in terminal.</span>
<span class="sd">        date : bool, optional</span>
<span class="sd">            Log the date. If set to False, the current date will not be attached to the logged</span>
<span class="sd">            message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_now</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="k">if</span> <span class="n">date</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">term</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">term</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Ansi</span><span class="p">,</span> <span class="s2">&quot;SUCCESS&quot;</span> <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;SUCCESS&quot;</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)(</span><span class="n">m</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">term</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">term</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="n">m</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="XletsHelperCore"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore">[docs]</a><span class="k">class</span> <span class="nc">XletsHelperCore</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Xlets core functions.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    xlets_meta : dict</span>
<span class="sd">        The metadata of all xlets in this repository.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        logger : object</span>
<span class="sd">            See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">XletsHelperCore</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span> <span class="o">=</span> <span class="n">AllXletsMetadata</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_meta_file</span><span class="p">()</span>

<div class="viewcode-block" id="XletsHelperCore.generate_meta_file"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore.generate_meta_file">[docs]</a>    <span class="k">def</span> <span class="nf">generate_meta_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See :any:`generate_meta_file`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">generate_meta_file</span><span class="p">()</span></div>

<div class="viewcode-block" id="XletsHelperCore.create_changelogs"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore.create_changelogs">[docs]</a>    <span class="k">def</span> <span class="nf">create_changelogs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create change logs.</span>

<span class="sd">        Generate the CHANGELOG.md files for all xlets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">changelog_handler</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating change logs...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="o">.</span><span class="n">meta_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating change log for </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;__data__&quot;</span><span class="p">,</span> <span class="s2">&quot;CHANGELOG.md&quot;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">log_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">changelog_handler</span><span class="o">.</span><span class="n">CHANGELOG_HEADER</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">xlet_name</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">repo_url</span><span class="o">=</span><span class="n">repo_url</span>
                    <span class="p">))</span>

                <span class="c1"># Generate change log from current repository paths.</span>
                <span class="n">relative_xlet_path</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span> <span class="o">+</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;s/&quot;</span> <span class="o">+</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">changelog_handler</span><span class="o">.</span><span class="n">git_log_cmd</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">xlet_slug</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">],</span>
                    <span class="n">relative_xlet_path</span><span class="o">=</span><span class="n">relative_xlet_path</span><span class="p">,</span>
                    <span class="n">append_or_override</span><span class="o">=</span><span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">,</span>
                    <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">,</span>
                    <span class="n">repo_url</span><span class="o">=</span><span class="n">repo_url</span>
                <span class="p">)</span>
                <span class="n">exec_command</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span>
                             <span class="n">working_directory</span><span class="o">=</span><span class="n">root_folder</span><span class="p">,</span>
                             <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletsHelperCore.update_pot_files"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore.update_pot_files">[docs]</a>    <span class="k">def</span> <span class="nf">update_pot_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update POT files.</span>

<span class="sd">        Update all .pot files from all xlets.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the make-cinnamon-xlet-pot-app command is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting POT files update...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="o">.</span><span class="n">meta_list</span><span class="p">:</span>
            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Updating localization template for </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="s2">&quot;make-cinnamon-xlet-pot-app&quot;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;MissingCommand: make-cinnamon-xlet-pot-app command not found!!!&quot;</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;make-cinnamon-xlet-pot-app&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;--custom-header&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;--scan-additional-file=../../__app__/python_modules/localized_help_creator.py&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;--ignored-pattern=__data__/*&quot;</span>
                <span class="p">]</span>
                <span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">xlet_root_folder</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">continue</span></div>

<div class="viewcode-block" id="XletsHelperCore.create_localized_help"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore.create_localized_help">[docs]</a>    <span class="k">def</span> <span class="nf">create_localized_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create localized help.</span>

<span class="sd">        Execute the z_create_localized_help.py script for each xlet to generate their</span>
<span class="sd">        HELP.html files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting localized help creation...&quot;</span><span class="p">)</span>

        <span class="n">applets_list_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extensions_list_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlets_meta</span><span class="o">.</span><span class="n">meta_list</span><span class="p">:</span>
            <span class="n">xlet_root_folder</span> <span class="o">=</span> <span class="n">get_parent_dir</span><span class="p">(</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">script_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_root_folder</span><span class="p">,</span> <span class="s2">&quot;z_create_localized_help.py&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">script_file_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating localized help for </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">call</span><span class="p">([</span><span class="n">script_file_path</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">xlet_root_folder</span><span class="p">)</span>

                <span class="c1"># Store list items for later creating the README.md file.</span>
                <span class="n">list_item</span> <span class="o">=</span> <span class="n">readme_list_item_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">xlet_name</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">xlet_slug</span><span class="o">=</span><span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;applet&quot;</span><span class="p">:</span>
                    <span class="n">applets_list_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_item</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">xlet</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span>
                    <span class="n">extensions_list_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating repository README.md file...&quot;</span><span class="p">)</span>

        <span class="n">readme_template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;README.md&quot;</span><span class="p">)</span>
        <span class="n">readme_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;README.md&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme_template_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readme_template</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">readme_template</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">readme_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readme_file</span><span class="p">:</span>
                <span class="n">readme_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">applets_help_pages</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">applets_list_items</span><span class="p">)),</span>
                    <span class="n">extensions_help_pages</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">extensions_list_items</span><span class="p">)),</span>
                    <span class="n">repo_pages_url</span><span class="o">=</span><span class="n">repo_pages_url</span>
                <span class="p">))</span></div>

<div class="viewcode-block" id="XletsHelperCore.generate_trans_stats"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore.generate_trans_stats">[docs]</a>    <span class="k">def</span> <span class="nf">generate_trans_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate translations statistics.</span>

<span class="sd">        Generates files that contain the amount of untranslated strings an xlet has.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the msgmerge command is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating translation statistics...&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="s2">&quot;msgmerge&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;MissingCommand: msgmerge command not found!!!&quot;</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

        <span class="n">markdown_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">po_tmp_storage</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;po_files_updated&quot;</span><span class="p">)</span>
        <span class="n">trans_stats_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;po_files_untranslated_table.md&quot;</span><span class="p">)</span>
        <span class="n">rmtree</span><span class="p">(</span><span class="n">po_tmp_storage</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">po_tmp_storage</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="n">get_xlets_dirs</span><span class="p">():</span>
            <span class="n">xlet_type</span><span class="p">,</span> <span class="n">xlet_dir_name</span> <span class="o">=</span> <span class="n">xlet</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">xlet_po_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">xlet_dir_name</span><span class="p">,</span> <span class="s2">&quot;po&quot;</span><span class="p">)</span>
            <span class="n">tmp_xlet_po_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">po_tmp_storage</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">xlet_dir_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tmp_xlet_po_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">xlet_po_dir</span><span class="p">):</span>
                <span class="n">xlet_po_list</span> <span class="o">=</span> <span class="n">recursive_glob</span><span class="p">(</span><span class="n">xlet_po_dir</span><span class="p">,</span> <span class="s2">&quot;*.po&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">xlet_po_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                     <span class="p">(</span><span class="n">xlet_type</span><span class="p">,</span> <span class="n">xlet_dir_name</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">markdown_content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">xlet_type</span><span class="p">,</span> <span class="n">xlet_dir_name</span><span class="p">)</span>
                    <span class="n">markdown_content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">markdown_content</span> <span class="o">+=</span> <span class="s2">&quot;|LANGUAGE|UNTRANSLATED|</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">markdown_content</span> <span class="o">+=</span> <span class="s2">&quot;|--------|------------|</span><span class="se">\n</span><span class="s2">&quot;</span>

                    <span class="k">for</span> <span class="n">po_file_path</span> <span class="ow">in</span> <span class="n">xlet_po_list</span><span class="p">:</span>
                        <span class="n">po_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">po_file_path</span><span class="p">)</span>
                        <span class="n">tmp_po_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_xlet_po_dir</span><span class="p">,</span> <span class="n">po_base_name</span><span class="p">)</span>
                        <span class="n">tmp_pot_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_po_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.pot&quot;</span> <span class="o">%</span> <span class="n">xlet_dir_name</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying </span><span class="si">%s</span><span class="s2"> to temporary location...&quot;</span> <span class="o">%</span>
                                         <span class="n">po_base_name</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">copy2</span><span class="p">(</span><span class="n">po_file_path</span><span class="p">,</span> <span class="n">tmp_po_file_path</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating temporary </span><span class="si">%s</span><span class="s2"> from localization template...&quot;</span> <span class="o">%</span>
                                         <span class="n">po_base_name</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">call</span><span class="p">([</span>
                            <span class="s2">&quot;msgmerge&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;--no-fuzzy-matching&quot;</span><span class="p">,</span>  <span class="c1"># Do not use fuzzy matching.</span>
                            <span class="s2">&quot;--previous&quot;</span><span class="p">,</span>           <span class="c1"># Keep previous msgids of translated messages.</span>
                            <span class="s2">&quot;--backup=off&quot;</span><span class="p">,</span>         <span class="c1"># Never make backups.</span>
                            <span class="s2">&quot;--update&quot;</span><span class="p">,</span>             <span class="c1"># Update .po file, do nothing if up to date.</span>
                            <span class="n">tmp_po_file_path</span><span class="p">,</span>       <span class="c1"># The .po file to update.</span>
                            <span class="n">tmp_pot_file_path</span>       <span class="c1"># The template file to update from.</span>
                        <span class="p">])</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Counting untranslated strings...&quot;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">trans_count_cmd</span> <span class="o">=</span> <span class="s1">&#39;msggrep -v -T -e &quot;.&quot; &quot;</span><span class="si">%s</span><span class="s1">&quot; | grep -c ^msgstr&#39;</span>
                        <span class="n">trans_count_output</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">trans_count_cmd</span> <span class="o">%</span> <span class="n">tmp_po_file_path</span><span class="p">,</span>
                                                 <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">,</span>
                                                 <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span>
                                                 <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
                        <span class="n">trans_count</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">trans_count_output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">markdown_content</span> <span class="o">+=</span> <span class="s2">&quot;|</span><span class="si">%s</span><span class="s2">|</span><span class="si">%s</span><span class="s2">|</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">po_base_name</span><span class="p">,</span> <span class="n">trans_count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">markdown_content</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">trans_stats_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trans_file</span><span class="p">:</span>
                <span class="n">trans_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">markdown_content</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletsHelperCore.update_spanish_localizations"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletsHelperCore.update_spanish_localizations">[docs]</a>    <span class="k">def</span> <span class="nf">update_spanish_localizations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update Spanish localizations.</span>

<span class="sd">        Update all Spanish localizations from all xlets.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the msgmerge command is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating Spanish localizations...&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="s2">&quot;msgmerge&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;MissingCommand: msgmerge command not found!!!&quot;</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">xlet</span> <span class="ow">in</span> <span class="n">get_xlets_dirs</span><span class="p">():</span>
            <span class="n">xlet_type</span><span class="p">,</span> <span class="n">xlet_dir_name</span> <span class="o">=</span> <span class="n">xlet</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">po_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span>
                                  <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">xlet_dir_name</span><span class="p">,</span> <span class="s2">&quot;po&quot;</span><span class="p">)</span>
            <span class="n">po_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">po_dir</span><span class="p">,</span> <span class="s2">&quot;es.po&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">po_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">po_file</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating localization for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xlet_dir_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">call</span><span class="p">([</span>
                    <span class="s2">&quot;msgmerge&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;--no-fuzzy-matching&quot;</span><span class="p">,</span>      <span class="c1"># Do not use fuzzy matching.</span>
                    <span class="s2">&quot;--previous&quot;</span><span class="p">,</span>               <span class="c1"># Keep previous msgids of translated messages.</span>
                    <span class="s2">&quot;--backup=off&quot;</span><span class="p">,</span>             <span class="c1"># Never make backups.</span>
                    <span class="s2">&quot;--update&quot;</span><span class="p">,</span>                 <span class="c1"># Update .po file, do nothing if up to date.</span>
                    <span class="s2">&quot;es.po&quot;</span><span class="p">,</span>                    <span class="c1"># The .po file to update.</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.pot&quot;</span> <span class="o">%</span> <span class="n">xlet_dir_name</span>    <span class="c1"># The template file to update from.</span>
                <span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">po_dir</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Something might have gone wrong!&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AllXletsMetadata"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.AllXletsMetadata">[docs]</a><span class="k">class</span> <span class="nc">AllXletsMetadata</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;All xlets metadata.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    meta_list : list</span>
<span class="sd">        A list of dictionaries containing all xlets metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;xlets_metadata.json&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meta_path</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="s2">&quot;xlets_metadata.json file not found. It will be generated.&quot;</span><span class="p">))</span>
                <span class="n">generate_meta_file</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">xlets_metadata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">xlets_metadata</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="generate_meta_file"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.generate_meta_file">[docs]</a><span class="k">def</span> <span class="nf">generate_meta_file</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generate the file containing all the metadata of all xlets on this repository.</span>
<span class="sd">    This metadata file is used by several functions on the XletsHelperCore class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s2">&quot;Generating xlets metadata file...&quot;</span><span class="p">))</span>
    <span class="n">xlet_meta_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xlet_meta</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;applets&quot;</span><span class="p">),</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;metadata.json&quot;</span><span class="p">:</span>
                <span class="n">xlet_meta_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;extensions&quot;</span><span class="p">),</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;metadata.json&quot;</span><span class="p">:</span>
                <span class="n">xlet_meta_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlet_meta_files</span><span class="p">)):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xlet_meta_files</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">xlet_meta_file</span><span class="p">:</span>
            <span class="n">raw_meta</span> <span class="o">=</span> <span class="n">xlet_meta_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">json_meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">raw_meta</span><span class="p">)</span>
            <span class="c1"># Store the path to the metadata.json file so I can use it to create</span>
            <span class="c1"># the different needed paths when needed.</span>
            <span class="c1"># This will allow me to avoid to constantly create a path with</span>
            <span class="c1"># os.path.join in my functions. I will just use the metadata.json path</span>
            <span class="c1"># and &quot;traverse it&quot;.</span>
            <span class="n">json_meta</span><span class="p">[</span><span class="s2">&quot;meta-path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlet_meta_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">json_meta</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">xlet_meta_files</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

            <span class="k">if</span> <span class="s2">&quot;/applets/&quot;</span> <span class="ow">in</span> <span class="n">xlet_meta_files</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">json_meta</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;applet&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;/extensions/&quot;</span> <span class="ow">in</span> <span class="n">xlet_meta_files</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">json_meta</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;extension&quot;</span>

            <span class="n">xlet_meta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_meta</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;xlets_metadata.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">xlet_meta</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_parent_dir"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_parent_dir">[docs]</a><span class="k">def</span> <span class="nf">get_parent_dir</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">go_up</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get parent directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fpath : str</span>
<span class="sd">        The full path to a file.</span>
<span class="sd">    go_up : int, optional</span>
<span class="sd">        How many directories to go up.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The new path to a directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">go_up</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">go_up</span><span class="p">)):</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dir_path</span></div>


<div class="viewcode-block" id="is_exec"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.is_exec">[docs]</a><span class="k">def</span> <span class="nf">is_exec</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if file is executable.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fpath : str</span>
<span class="sd">        The path to the file to check.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        If file is executable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_log_file"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_log_file">[docs]</a><span class="k">def</span> <span class="nf">get_log_file</span><span class="p">(</span><span class="n">storage_dir</span><span class="o">=</span><span class="s2">&quot;tmp/logs&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">subfix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get log file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The log file to be used by :any:`LogSystem`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storage_dir : str, optional</span>
<span class="sd">        Path to the folder to store the log files.</span>
<span class="sd">    prefix : str, optional</span>
<span class="sd">        String at the beginning of the file name.</span>
<span class="sd">    subfix : str, optional</span>
<span class="sd">        String at the end of the file name.</span>
<span class="sd">    delimiter : str, optional</span>
<span class="sd">        Character to separate the different parts of the files name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{prefix}{date}{subfix}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">delimiter</span> <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">date</span><span class="o">=</span><span class="n">micro_to_milli</span><span class="p">(</span><span class="n">get_date_time</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)),</span>
        <span class="n">subfix</span><span class="o">=</span><span class="n">delimiter</span> <span class="o">+</span> <span class="n">subfix</span> <span class="k">if</span> <span class="n">subfix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_date_time"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_date_time">[docs]</a><span class="k">def</span> <span class="nf">get_date_time</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get date time.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The current time formatted by the &quot;type&quot; passed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    type : str, optional</span>
<span class="sd">        The time &quot;type&quot; to return (Default: date).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;appid&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%H-%M-%S-</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;filename&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H.%M.%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># type == &quot;date&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="micro_to_milli"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.micro_to_milli">[docs]</a><span class="k">def</span> <span class="nf">micro_to_milli</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Microseconds to milliseconds.</span>

<span class="sd">    Convert a date string from using microseconds to use milliseconds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    date : str</span>
<span class="sd">        The date string to convert.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The date string converted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">date</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:03d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)))</span></div>


<div class="viewcode-block" id="get_time_diff"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_time_diff">[docs]</a><span class="k">def</span> <span class="nf">get_time_diff</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get time difference.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : str</span>
<span class="sd">        Start date.</span>
<span class="sd">    e : str</span>
<span class="sd">        End date.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The difference in hours, minutes, seconds, and milliseconds between two dates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ends</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="n">ends</span> <span class="o">-</span> <span class="n">start</span>

    <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> hr/s, </span><span class="si">%d</span><span class="s2"> min/s, </span><span class="si">%d</span><span class="s2"> sec/s, </span><span class="si">%d</span><span class="s2"> msec/s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span></div>


<div class="viewcode-block" id="confirm"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.confirm">[docs]</a><span class="k">def</span> <span class="nf">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prompts for yes or no response from the user.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prompt : None, optional</span>
<span class="sd">        The prompt text.</span>
<span class="sd">    response : bool, optional</span>
<span class="sd">        &quot;response&quot; should be set to the default value assumed by the caller when</span>
<span class="sd">        user simply types ENTER.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True for &quot;yes&quot; or False for &quot;no&quot;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; confirm(prompt=&#39;Create Directory?&#39;, response=True)</span>
<span class="sd">    Create Directory? [Y|n]:</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; confirm(prompt=&#39;Create Directory?&#39;, response=False)</span>
<span class="sd">    Create Directory? [N|y]:</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; confirm(prompt=&#39;Create Directory?&#39;, response=False)</span>
<span class="sd">    Create Directory? [N|y]: y</span>
<span class="sd">    True</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">        `Based on &lt;http://code.activestate.com/recipes/541096-prompt-the-user-for-confirmation&gt;`__.</span>
<span class="sd">        Eradicated Python 2 code from original function and added &quot;transparent handling&quot; of upper/</span>
<span class="sd">        lower case input responses.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyboardInterruption</span>
<span class="sd">        Halt execution on Ctrl + C press.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Confirm&quot;</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">]: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">]: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Lower the input case just so I don&#39;t have to micro-manage the answer.</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="n">prompt</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ans</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>

            <span class="k">if</span> <span class="n">ans</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s2">&quot;Please enter y or n.&quot;</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">KeyboardInterruption</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_cli_header"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_cli_header">[docs]</a><span class="k">def</span> <span class="nf">get_cli_header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">char</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a &quot;decorated header&quot;.</span>

<span class="sd">    Get a &quot;decorated header&quot; to display at the beginning of the CLI execution (or whenever it is</span>
<span class="sd">    needed).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The application name or a &quot;title&quot; to display as a &quot;header&quot;.</span>
<span class="sd">    char : str, optional</span>
<span class="sd">        The &quot;decorator&quot; character.</span>
<span class="sd">    length : int, optional</span>
<span class="sd">        The total length that each line should have.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The actual &quot;header&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">term_length</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">24</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">80</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="n">get_cli_separator</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="n">sub_sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">term_length</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">char</span><span class="p">)</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sub_sep</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sub_sep</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">term_length</span><span class="p">:</span>
            <span class="n">mid</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">term_length</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">header</span> <span class="o">=</span> <span class="n">sep</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">header</span> <span class="o">+=</span> <span class="n">mid</span><span class="p">[:</span><span class="n">term_length</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">header</span> <span class="o">+=</span> <span class="n">sep</span>

    <span class="k">return</span> <span class="n">header</span></div>


<div class="viewcode-block" id="get_cli_separator"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_cli_separator">[docs]</a><span class="k">def</span> <span class="nf">get_cli_separator</span><span class="p">(</span><span class="n">char</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a &quot;decorated separator&quot;.</span>

<span class="sd">    Get a &quot;decorated separator&quot; to display whenever it is needed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    char : str, optional</span>
<span class="sd">        The &quot;decorator&quot; character.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The actual &quot;separator&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">term_length</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">24</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">80</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">term_length</span> <span class="o">*</span> <span class="n">char</span><span class="p">)</span></div>


<div class="viewcode-block" id="term_input"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.term_input">[docs]</a><span class="k">def</span> <span class="nf">term_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get input from terminal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prompt : str</span>
<span class="sd">        Text to be prompted with.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Entered string.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">        Extracted from Sphinx itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="nonempty"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.nonempty">[docs]</a><span class="k">def</span> <span class="nf">nonempty</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check for non empty.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        String to check.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The string passed.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValidationError</span>
<span class="sd">        Raise if empty.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">        Extracted from Sphinx itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Please enter some text.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="term_decode"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.term_decode">[docs]</a><span class="k">def</span> <span class="nf">term_decode</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decode terminal input.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        Entered text.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Decoded text.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">        Extracted from Sphinx itself. Eradicated Python 2 specific code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="s2">&quot;* Note: non-ASCII characters entered &quot;</span>
                       <span class="s2">&quot;and terminal encoding unknown -- assuming &quot;</span>
                       <span class="s2">&quot;UTF-8 or Latin-1.&quot;</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;latin1&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">text</span></div>


<div class="viewcode-block" id="do_prompt"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.do_prompt">[docs]</a><span class="k">def</span> <span class="nf">do_prompt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="n">nonempty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prompt function for interactively ask user for data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d : dict</span>
<span class="sd">        A dictionary of options.</span>
<span class="sd">    key : str</span>
<span class="sd">        The &quot;key&quot; to change from &quot;d&quot;.</span>
<span class="sd">    text : str</span>
<span class="sd">        The prompt text.</span>
<span class="sd">    default : None, optional</span>
<span class="sd">        Default option if none entered.</span>
<span class="sd">    validator : function, optional</span>
<span class="sd">        A function to validate the input if needed.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">        Extracted from Sphinx itself. Eradicated Python 2 specific code.</span>
<span class="sd">        Keeping it with the same capabilities just in case that I find more uses for it.</span>
<span class="sd">        For example: ask user for multiple options in one go.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyboardInterruption</span>
<span class="sd">        Halt execution on Ctrl + C press.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span>

            <span class="n">prompt</span> <span class="o">=</span> <span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">term_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">default</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">default</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">term_decode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;* &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)))</span>
                <span class="k">continue</span>
            <span class="k">break</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">KeyboardInterruption</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span></div>


<div class="viewcode-block" id="do_template_copy"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.do_template_copy">[docs]</a><span class="k">def</span> <span class="nf">do_template_copy</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{},</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do the actual copy of template files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source : str</span>
<span class="sd">        Full file path source.</span>
<span class="sd">    destination : str</span>
<span class="sd">        Full file path destination.</span>
<span class="sd">    options : dict, optional</span>
<span class="sd">        A dictionary of options.</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    err</span>
<span class="sd">        Halt execution if any error is found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">template_file</span><span class="p">:</span>
        <span class="n">template_data</span> <span class="o">=</span> <span class="n">template_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;replacements&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;replacements&quot;</span><span class="p">):</span>
                <span class="n">template_data</span> <span class="o">=</span> <span class="n">template_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">err</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">destination_file</span><span class="p">:</span>
        <span class="n">destination_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template_data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;set_executable&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="mo">0o777</span><span class="p">)</span></div>


<span class="n">BASH_COMPLETION_LOADER_CONTENT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">if [[ -d &quot;$HOME/.bash_completion.d&quot; ]]; then</span>
<span class="s2">    for bcfile in &quot;$HOME/.bash_completion.d&quot;/*; do</span>
<span class="s2">        . $bcfile</span>
<span class="s2">    done</span>
<span class="s2">fi</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="system_executable_generation"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.system_executable_generation">[docs]</a><span class="k">def</span> <span class="nf">system_executable_generation</span><span class="p">(</span><span class="n">exec_name</span><span class="p">,</span> <span class="n">app_root_folder</span><span class="p">,</span> <span class="n">do_completions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate system executable and bash completions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    exec_name : str</span>
<span class="sd">        Default file name in case a custom one isn&#39;t chosen.</span>
<span class="sd">    app_root_folder : str</span>
<span class="sd">        The application&#39;s root folder.</span>
<span class="sd">    do_completions : bool, optional</span>
<span class="sd">        Whether to perform bash completions installation or not.</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sys_exec_template</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;system_executable&quot;</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sys_exec_path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">HOME</span><span class="p">,</span> <span class="s2">&quot;.local&quot;</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;Set an executable file name or press Enter to use default&quot;</span><span class="p">))</span>
    <span class="n">do_prompt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter a file name&quot;</span><span class="p">,</span> <span class="n">exec_name</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;Set full path to store executable file or press Enter to use default&quot;</span><span class="p">))</span>
    <span class="n">do_prompt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;sys_exec_path&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter absolute path&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sys_exec_path&quot;</span><span class="p">])</span>

    <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;sys_exec_path&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;sys_exec_path&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="s2">&quot;Path doesn&#39;t exists and needs to be created&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;sys_exec_path&quot;</span><span class="p">],</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;sys_exec_path&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="s2">&quot;Chosen path isn&#39;t a directory. Aborted!!!&quot;</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">generate_from_template</span><span class="p">(</span><span class="n">sys_exec_template</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="n">system_executable_generation</span><span class="p">,</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">exec_name</span><span class="p">,</span> <span class="n">app_root_folder</span><span class="p">,</span> <span class="n">logger</span><span class="p">),</span>
        <span class="s2">&quot;replacements&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;</span><span class="si">{full_path_to_app_folder}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">app_root_folder</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="s2">&quot;set_executable&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">do_completions</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">bash_completions_file_source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">app_root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;bash_completions.bash&quot;</span><span class="p">)</span>
    <span class="n">bash_completions_file_destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">HOME</span><span class="p">,</span> <span class="s2">&quot;.bash_completion.d&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.completion.bash&quot;</span><span class="p">)</span>
    <span class="n">bash_completions_loader</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">HOME</span><span class="p">,</span> <span class="s2">&quot;.bash_completion&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="n">bash_completions_step1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">bash_completions_file_destination</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">generate_from_template</span><span class="p">(</span><span class="n">bash_completions_file_source</span><span class="p">,</span> <span class="n">bash_completions_file_destination</span><span class="p">,</span>
                               <span class="n">options</span><span class="o">=</span><span class="p">{</span>
                                   <span class="s2">&quot;replacements&quot;</span><span class="p">:</span> <span class="p">[</span>
                                       <span class="c1"># Not implemented yet, but leave it.</span>
                                       <span class="c1"># Come back to it when I figure out how to make the bash</span>
                                       <span class="c1"># completions work as I want them to work. ¬¬</span>
                                       <span class="p">(</span><span class="s2">&quot;</span><span class="si">{full_path_to_app_folder}</span><span class="s2">&quot;</span><span class="p">,</span>
                                        <span class="n">app_root_folder</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s2">&quot;</span><span class="si">{executable_name}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                                   <span class="p">],</span>
                                   <span class="s2">&quot;set_executable&quot;</span><span class="p">:</span> <span class="kc">False</span>
                               <span class="p">},</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="n">bash_completions_step2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">HOME</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="n">get_cli_separator</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="n">BASH_COMPLETION_LOADER_CONTENT</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="n">get_cli_separator</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># KISS. If the exact string &quot;/.bash_completion.d/&quot; is found, assume that it is used to</span>
            <span class="c1"># load the content of this directory as bash completions.</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bash_completions_loader</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;/.bash_completion.d/&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;The &lt;</span><span class="si">%s</span><span class="s2">/.bash_completion.d&gt; directory seems to be set up.&quot;</span> <span class="o">%</span> <span class="n">HOME</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Check the &lt;</span><span class="si">%s</span><span class="s2">&gt; file content just in case.&quot;</span> <span class="o">%</span>
                                <span class="n">bash_completions_loader</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">BASH_COMPLETION_LOADER_CONTENT</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bash completion loader set up.&quot;</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="generate_from_template"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.generate_from_template">[docs]</a><span class="k">def</span> <span class="nf">generate_from_template</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{},</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a file from a template.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source : str</span>
<span class="sd">        Full file path source.</span>
<span class="sd">    destination : str</span>
<span class="sd">        Full file path destination.</span>
<span class="sd">    options : dict, optional</span>
<span class="sd">        A set of options. Possible values are:</span>

<span class="sd">        - **replacements**: A list of tuples to be used by the :any:`str.replace` function found in \</span>
<span class="sd">        :any:`do_template_copy`.</span>
<span class="sd">        - **set_executable**: A bool used to determine is the file created by :any:`do_template_copy` \</span>
<span class="sd">        should be made executable.</span>
<span class="sd">        - **callback**: A reference to the function that called :any:`generate_from_template`.</span>
<span class="sd">        - **args**: The arguments passed to &quot;callback&quot;.</span>

<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Stops execution when calling a callback function.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    Exception</span>
<span class="sd">        Something went wrong! ¬¬</span>
<span class="sd">    KeyboardInterruption</span>
<span class="sd">        Halt execution on Ctrl + C press.</span>
<span class="sd">    OperationAborted</span>
<span class="sd">        Halt execution.</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        Raised if the destination isn&#39;t a folder.</span>
<span class="sd">    SystemExit</span>
<span class="sd">        Halt execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The file &lt;</span><span class="si">%s</span><span class="s2">&gt; exists!&quot;</span> <span class="o">%</span> <span class="n">destination</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Overwrite existent file?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">do_template_copy</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Call back the function that called this function. LOL</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrying...&quot;</span><span class="p">)</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">)(</span><span class="o">*</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">))</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="s2">&quot;Operation aborted.&quot;</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dirname</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">dirname</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;Destination &lt;</span><span class="si">%s</span><span class="s2">&gt; should be a directory!!!&quot;</span> <span class="o">%</span> <span class="n">dirname</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">None</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>

            <span class="n">do_template_copy</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">KeyboardInterruption</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">SystemExit</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OperationAborted</span><span class="p">(</span><span class="s2">&quot;Operation aborted.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Something went wrong!&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;File created at:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span></div>


<div class="viewcode-block" id="exec_command"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.exec_command">[docs]</a><span class="k">def</span> <span class="nf">exec_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">,</span> <span class="n">do_wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;exec_command</span>

<span class="sd">    Run commands using Popen.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cmd : str</span>
<span class="sd">        The command to run.</span>
<span class="sd">    working_directory : str</span>
<span class="sd">        Working directory used by the command.</span>
<span class="sd">    do_wait : bool, optional</span>
<span class="sd">        Call or not the Popen wait() method. (default: {True})</span>
<span class="sd">    do_log : bool, optional</span>
<span class="sd">        Log or not the command output. (default: {True})</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Passing a list instead of a string is the recommended.</span>
        <span class="c1"># I would do so if it would freaking work!!!</span>
        <span class="c1"># Always one step forward and two steps back with Python!!!</span>
        <span class="n">po</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span>
            <span class="n">cmd</span><span class="p">,</span>
            <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stdin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">do_wait</span><span class="p">:</span>
            <span class="n">po</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">do_log</span><span class="p">:</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">error_output</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">po</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_output</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Execution failed!!!&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="build_xlets"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.build_xlets">[docs]</a><span class="k">def</span> <span class="nf">build_xlets</span><span class="p">(</span><span class="n">xlets</span><span class="o">=</span><span class="p">[],</span> <span class="n">domain_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">build_output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">do_not_cofirm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_menu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build xlets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xlets : list, optional</span>
<span class="sd">        The list of xlets to build.</span>
<span class="sd">    domain_name : None, optional</span>
<span class="sd">        The domain name to use to build the xlets.</span>
<span class="sd">    build_output : str, optional</span>
<span class="sd">        Path to the folder were the built xlets are stored.</span>
<span class="sd">    do_not_cofirm : bool, optional</span>
<span class="sd">        Whether to ask for overwrite confirmation when an xlet destination exists or not.</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    from_menu : bool, optional</span>
<span class="sd">        Whether this function was called from the CLI menu or not.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    SystemExit</span>
<span class="sd">        Halt execution if the domain name cannot be obtained.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_name</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">domain_storage_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">domain_file</span><span class="p">:</span>
                <span class="n">domain_name</span> <span class="o">=</span> <span class="n">domain_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">missing_domain_msg</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># Implement a &quot;domain name validator&quot; function.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">domain_name</span><span class="p">:</span>
        <span class="c1"># Message from the raised exception isn&#39;t printed when this function</span>
        <span class="c1"># is executed from the CLI menu.</span>
        <span class="c1"># So, print the message explicitly.</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">missing_domain_msg</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">build_output</span><span class="p">:</span>
        <span class="n">base_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_temp_folder</span><span class="p">,</span> <span class="n">micro_to_milli</span><span class="p">(</span><span class="n">get_date_time</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_output_path</span> <span class="o">=</span> <span class="n">build_output</span>

    <span class="n">all_xlets</span> <span class="o">=</span> <span class="n">get_xlets_dirs</span><span class="p">()</span>

    <span class="n">xlets_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">xlets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xlets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_xlets</span><span class="p">:</span>
                <span class="n">xlet_type</span><span class="p">,</span> <span class="n">xlet_dir_name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">uuid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">@</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xlet_dir_name</span><span class="p">,</span> <span class="n">domain_name</span><span class="p">)</span>
                <span class="n">xlets_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                    <span class="s2">&quot;slug&quot;</span><span class="p">:</span> <span class="n">xlet_dir_name</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">xlet_dir_name</span><span class="p">),</span>
                    <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_output_path</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">xlet_type</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">uuid</span><span class="p">),</span>
                <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> doesn&#39;t exists.&quot;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xlets_data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">xlets_data</span><span class="p">:</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">XletBuilder</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">do_not_cofirm</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Built xlets saved in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">base_output_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="XletBuilder"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletBuilder">[docs]</a><span class="k">class</span> <span class="nc">XletBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;docstring for XletBuilder</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    config_file : str</span>
<span class="sd">        Path to the file z_config.py inside an xlet folder.</span>
<span class="sd">    do_not_cofirm : bool</span>
<span class="sd">        Whether to ask for overwrite confirmation when an xlet destination exists or not.</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    replacement_data : list</span>
<span class="sd">        Data used to perform string substitutions. It is a list of tuples with two items.</span>
<span class="sd">    schemas_dir : str</span>
<span class="sd">        Path to the folder schemas inside an xlet folder.</span>
<span class="sd">    xlet_data : dict</span>
<span class="sd">        The xlet data to handle.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlet_data</span><span class="p">,</span> <span class="n">do_not_cofirm</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlet_data : dict</span>
<span class="sd">            The xlet data to handle.</span>
<span class="sd">        do_not_cofirm : bool</span>
<span class="sd">            Whether to ask for overwrite confirmation when an xlet destination exists or not.</span>
<span class="sd">        logger : object</span>
<span class="sd">            See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">XletBuilder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span> <span class="o">=</span> <span class="n">xlet_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_not_cofirm</span> <span class="o">=</span> <span class="n">do_not_cofirm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="s2">&quot;schemas&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="s2">&quot;z_config.py&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replacement_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;{{UUID}}&quot;</span><span class="p">,</span> <span class="n">xlet_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;{{REPO_URL}}&quot;</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;{{XLET_TYPE}}&quot;</span><span class="p">,</span> <span class="n">xlet_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
        <span class="p">]</span>

<div class="viewcode-block" id="XletBuilder.build"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build xlet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">get_cli_separator</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Building the </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_do_copy</span><span class="p">()</span>
        <span class="n">do_string_substitutions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">replacement_data</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_schemas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_config_file</span><span class="p">()</span></div>

<div class="viewcode-block" id="XletBuilder._do_copy"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletBuilder._do_copy">[docs]</a>    <span class="k">def</span> <span class="nf">_do_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy xlet files into its final destination.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidDestination</span>
<span class="sd">            Invalid xlet destination.</span>
<span class="sd">        OperationAborted</span>
<span class="sd">            Halt build operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">InvalidDestination</span><span class="p">(</span>
                <span class="s2">&quot;Destination exists and is a file!!! Aborted!!!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_not_cofirm</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">existent_xlet_destination_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">])))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_not_cofirm</span> <span class="ow">or</span> <span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OperationAborted</span><span class="p">(</span><span class="s2">&quot;Building the </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> was canceled.&quot;</span> <span class="o">%</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying main xlet files...&quot;</span><span class="p">)</span>
        <span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ignore</span><span class="o">=</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="o">*</span><span class="n">xlet_dir_ignored_patterns</span><span class="p">),</span>
                 <span class="n">ignore_dangling_symlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying common xlet files...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">extra_common_files</span><span class="p">:</span>
            <span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;source_path&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]),</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="XletBuilder._compile_schemas"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletBuilder._compile_schemas">[docs]</a>    <span class="k">def</span> <span class="nf">_compile_schemas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compile schemas file if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas_dir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Compiling gsettings schema...&quot;</span><span class="p">)</span>
            <span class="n">call</span><span class="p">([</span><span class="s2">&quot;glib-compile-schemas&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;--targetdir=.&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="XletBuilder._handle_config_file"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.XletBuilder._handle_config_file">[docs]</a>    <span class="k">def</span> <span class="nf">_handle_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle xlet configuration file if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">runpy</span> <span class="k">import</span> <span class="n">run_path</span>
            <span class="n">extra_settings</span> <span class="o">=</span> <span class="n">run_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">)[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">extra_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symlinks&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating symbolic links...&quot;</span><span class="p">)</span>

                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">])</span>

                <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">extra_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symlinks&quot;</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="nb">dir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="n">extra_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;symlinks&quot;</span><span class="p">)[</span><span class="nb">dir</span><span class="p">]:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>

                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">root_folder</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="get_xlets_dirs"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.get_xlets_dirs">[docs]</a><span class="k">def</span> <span class="nf">get_xlets_dirs</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get xlets dirs.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        The list of xlets directory names prefixed with their &quot;types&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">applets_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Applet &quot;</span> <span class="o">+</span>
                    <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;applets&quot;</span><span class="p">))]</span>
    <span class="n">extensions_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Extension &quot;</span> <span class="o">+</span>
                       <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;extensions&quot;</span><span class="p">))]</span>

    <span class="k">return</span> <span class="n">applets_dirs</span> <span class="o">+</span> <span class="n">extensions_dirs</span></div>


<div class="viewcode-block" id="validate_themes_options"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.validate_themes_options">[docs]</a><span class="k">def</span> <span class="nf">validate_themes_options</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate themes options.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        The entered option to validate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The validated option.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValidationError</span>
<span class="sd">        Halt execution if option is not valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Posible options are &quot;1&quot; or &quot;2&quot;.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="build_themes"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.build_themes">[docs]</a><span class="k">def</span> <span class="nf">build_themes</span><span class="p">(</span><span class="n">theme_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">build_output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">do_not_cofirm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_menu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build themes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theme_name : str, optional</span>
<span class="sd">        The given name of the theme.</span>
<span class="sd">    build_output : str, optional</span>
<span class="sd">        Path to the destination folder were the built themes will be saved.</span>
<span class="sd">    do_not_cofirm : bool, optional</span>
<span class="sd">        Whether to ask for overwrite confirmation when a theme destination exists or not.</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    from_menu : bool, optional</span>
<span class="sd">        Whether this function was called from the CLI menu or not.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    SystemExit</span>
<span class="sd">        Halt execution if the theme name cannot be obtained.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cinnamon_version&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;3.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;3.4&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;gtk3_version&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;3.18&quot;</span><span class="p">,</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;3.22&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">options_map_defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cinnamon_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cinnamon_font_size&quot;</span><span class="p">:</span> <span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cinnamon_font_family&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;Noto Sans&quot;, sans, Sans-Serif&#39;</span><span class="p">,</span>
        <span class="s2">&quot;gtk3_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;Choose in which Cinnamon version the theme will be used.&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;1. 3.0.x to 3.2.x (Default)&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;2. 3.4.x to 3.8.x&quot;</span><span class="p">))</span>

    <span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span> <span class="s2">&quot;cinnamon_version&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter an option&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
              <span class="n">validator</span><span class="o">=</span><span class="n">validate_themes_options</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;Set the Cinnamon theme font size.&quot;</span><span class="p">))</span>

    <span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span> <span class="s2">&quot;cinnamon_font_size&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter a value&quot;</span><span class="p">,</span> <span class="s2">&quot;9pt&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;Set the Cinnamon theme font family.&quot;</span><span class="p">))</span>

    <span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span> <span class="s2">&quot;cinnamon_font_family&quot;</span><span class="p">,</span>
              <span class="s2">&quot;Enter a value&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;Noto Sans&quot;, sans, Sans-Serif&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;Choose in which Gtk+ version the theme will be used.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;1. 3.18.x (Default)&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;2. 3.22.x&quot;</span><span class="p">))</span>

    <span class="n">do_prompt</span><span class="p">(</span><span class="n">options_map_defaults</span><span class="p">,</span> <span class="s2">&quot;gtk3_version&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter an option&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
              <span class="n">validator</span><span class="o">=</span><span class="n">validate_themes_options</span><span class="p">)</span>

    <span class="n">theme_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cinnamon_version&quot;</span><span class="p">:</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;cinnamon_version&quot;</span><span class="p">][</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;cinnamon_version&quot;</span><span class="p">]],</span>
        <span class="s2">&quot;cinnamon_font_size&quot;</span><span class="p">:</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;cinnamon_font_size&quot;</span><span class="p">],</span>
        <span class="s2">&quot;cinnamon_font_family&quot;</span><span class="p">:</span> <span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;cinnamon_font_family&quot;</span><span class="p">],</span>
        <span class="s2">&quot;gtk3_version&quot;</span><span class="p">:</span> <span class="n">options_map</span><span class="p">[</span><span class="s2">&quot;gtk3_version&quot;</span><span class="p">][</span><span class="n">options_map_defaults</span><span class="p">[</span><span class="s2">&quot;gtk3_version&quot;</span><span class="p">]]</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">theme_name</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">theme_name_storage_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">theme_file</span><span class="p">:</span>
                <span class="n">theme_name</span> <span class="o">=</span> <span class="n">theme_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">missing_theme_name_msg</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">theme_name</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">missing_theme_name_msg</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">build_output</span><span class="p">:</span>
        <span class="n">base_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_temp_folder</span><span class="p">,</span> <span class="n">micro_to_milli</span><span class="p">(</span><span class="n">get_date_time</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_output_path</span> <span class="o">=</span> <span class="n">build_output</span>

    <span class="n">themes_sources</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;themes&quot;</span><span class="p">)</span>
    <span class="n">common_version_insensitive_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">themes_sources</span><span class="p">,</span> <span class="s2">&quot;_common&quot;</span><span class="p">,</span> <span class="s2">&quot;_version_insensitive&quot;</span><span class="p">)</span>
    <span class="n">common_version_sensitive</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">themes_sources</span><span class="p">,</span> <span class="s2">&quot;_common&quot;</span><span class="p">,</span> <span class="s2">&quot;_version_sensitive&quot;</span><span class="p">)</span>
    <span class="n">common_version_sensitive_cinnamon_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">common_version_sensitive</span><span class="p">,</span> <span class="s2">&quot;cinnamon&quot;</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">[</span><span class="s2">&quot;cinnamon_version&quot;</span><span class="p">])</span>
    <span class="n">common_version_sensitive_gtk3_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">common_version_sensitive</span><span class="p">,</span> <span class="s2">&quot;gtk-3.0&quot;</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">[</span><span class="s2">&quot;gtk3_version&quot;</span><span class="p">])</span>
    <span class="n">theme_variants</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">themes_sources</span><span class="p">,</span> <span class="s2">&quot;_variants&quot;</span><span class="p">))</span>

    <span class="kn">from</span> <span class="nn">runpy</span> <span class="k">import</span> <span class="n">run_path</span>

    <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">theme_variants</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating variant: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">variant</span><span class="p">)</span>

        <span class="n">full_theme_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theme_name</span><span class="p">,</span> <span class="n">variant</span><span class="p">)</span>

        <span class="n">destination_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_output_path</span><span class="p">,</span> <span class="n">full_theme_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;InvalidDestination: Destination exists and is a file!!! Aborted!!!&quot;</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">do_not_cofirm</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">WARNING</span><span class="p">(</span><span class="n">existent_xlet_destination_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">destination_folder</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">do_not_cofirm</span> <span class="ow">or</span> <span class="n">confirm</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">rmtree</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s2">&quot;OperationAborted: The theme building process was canceled.&quot;</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

        <span class="n">variant_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">themes_sources</span><span class="p">,</span> <span class="s2">&quot;_variants&quot;</span><span class="p">,</span> <span class="n">variant</span><span class="p">)</span>
        <span class="n">variant_config</span> <span class="o">=</span> <span class="n">run_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variant_folder</span><span class="p">,</span> <span class="s2">&quot;config.py&quot;</span><span class="p">))[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>
        <span class="n">variant_config</span><span class="p">[</span><span class="s2">&quot;replacement_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;@repo_url@&quot;</span><span class="p">,</span> <span class="n">repo_url</span><span class="p">))</span>
        <span class="n">variant_config</span><span class="p">[</span><span class="s2">&quot;replacement_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;@theme_name@&quot;</span><span class="p">,</span> <span class="n">theme_name</span><span class="p">))</span>
        <span class="n">variant_config</span><span class="p">[</span><span class="s2">&quot;replacement_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;@theme_variant@&quot;</span><span class="p">,</span> <span class="n">variant</span><span class="p">))</span>
        <span class="n">variant_config</span><span class="p">[</span><span class="s2">&quot;replacement_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;&quot;@font_size@&quot;&#39;</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">[</span><span class="s2">&quot;cinnamon_font_size&quot;</span><span class="p">]))</span>
        <span class="n">variant_config</span><span class="p">[</span><span class="s2">&quot;replacement_data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;&quot;@font_family@&quot;&#39;</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">[</span><span class="s2">&quot;cinnamon_font_family&quot;</span><span class="p">]))</span>
        <span class="n">variant_version_insensitive_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variant_folder</span><span class="p">,</span> <span class="s2">&quot;_version_insensitive&quot;</span><span class="p">)</span>
        <span class="n">variant_version_sensitive</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variant_folder</span><span class="p">,</span> <span class="s2">&quot;_version_sensitive&quot;</span><span class="p">)</span>
        <span class="n">variant_version_sensitive_cinnamon_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">variant_version_sensitive</span><span class="p">,</span> <span class="s2">&quot;cinnamon&quot;</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">[</span><span class="s2">&quot;cinnamon_version&quot;</span><span class="p">])</span>
        <span class="n">variant_version_sensitive_gtk3_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">variant_version_sensitive</span><span class="p">,</span> <span class="s2">&quot;gtk-3.0&quot;</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">[</span><span class="s2">&quot;gtk3_version&quot;</span><span class="p">])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying files...&quot;</span><span class="p">)</span>
        <span class="n">custom_copytree</span><span class="p">(</span><span class="n">common_version_insensitive_files</span><span class="p">,</span> <span class="n">destination_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">common_version_sensitive_cinnamon_files</span><span class="p">):</span>
            <span class="n">custom_copytree</span><span class="p">(</span><span class="n">common_version_sensitive_cinnamon_files</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="s2">&quot;cinnamon&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">common_version_sensitive_gtk3_files</span><span class="p">):</span>
            <span class="n">custom_copytree</span><span class="p">(</span><span class="n">common_version_sensitive_gtk3_files</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="s2">&quot;gtk-3.0&quot;</span><span class="p">))</span>

        <span class="n">custom_copytree</span><span class="p">(</span><span class="n">variant_version_insensitive_files</span><span class="p">,</span> <span class="n">destination_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">variant_version_sensitive_gtk3_files</span><span class="p">):</span>
            <span class="n">custom_copytree</span><span class="p">(</span><span class="n">variant_version_sensitive_gtk3_files</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="s2">&quot;gtk-3.0&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">variant_version_sensitive_cinnamon_files</span><span class="p">):</span>
            <span class="n">custom_copytree</span><span class="p">(</span><span class="n">variant_version_sensitive_cinnamon_files</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="s2">&quot;cinnamon&quot;</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing string substitutions...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="c1"># Only deal with a limited set of file extensions.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.css&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;.rc&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;gtkrc&quot;</span><span class="p">,</span> <span class="s2">&quot;.theme&quot;</span><span class="p">,</span> <span class="s2">&quot;.ini&quot;</span><span class="p">)):</span>
                    <span class="k">continue</span>

                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file_data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">file_data_modified</span> <span class="o">=</span> <span class="n">do_replacements</span><span class="p">(</span>
                        <span class="n">file_data</span><span class="p">,</span> <span class="n">variant_config</span><span class="p">[</span><span class="s2">&quot;replacement_data&quot;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">file_data_modified</span> <span class="o">!=</span> <span class="n">file_data</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_data_modified</span><span class="p">)</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Theme variant </span><span class="si">%s</span><span class="s2"> succesfully built.&quot;</span> <span class="o">%</span> <span class="n">variant</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Built themes saved in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">base_output_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="do_replacements"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.do_replacements">[docs]</a><span class="k">def</span> <span class="nf">do_replacements</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">replacement_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do replacements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : str</span>
<span class="sd">        Data to modify.</span>
<span class="sd">    replacement_data : list</span>
<span class="sd">        List of tuples containing (template, replacement) data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Modified data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">template</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">replacement_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="do_string_substitutions"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.do_string_substitutions">[docs]</a><span class="k">def</span> <span class="nf">do_string_substitutions</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">replacement_data</span><span class="p">,</span>
                            <span class="n">allowed_extensions</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.bash&quot;</span><span class="p">,</span> <span class="s2">&quot;.js&quot;</span><span class="p">,</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;.xml&quot;</span><span class="p">),</span>
                            <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do substitutions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dir_path : str</span>
<span class="sd">        Path to a directory where to perform string substitutions on.</span>
<span class="sd">    replacement_data : list</span>
<span class="sd">        Data used to perform string substitutions.</span>
<span class="sd">    allowed_extensions : tuple, optional</span>
<span class="sd">        A tuple of file extensions that are allowed to be modified.</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing string substitutions...&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="c1"># Only deal with a limited set of file extensions.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">allowed_extensions</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file_data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">file_data</span> <span class="o">=</span> <span class="n">do_replacements</span><span class="p">(</span><span class="n">file_data</span><span class="p">,</span> <span class="n">replacement_data</span><span class="p">)</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
                <span class="n">file</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

            <span class="c1"># Check and set execution permissions for Bash and Python scripts.</span>
            <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span> <span class="s2">&quot;.bash&quot;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_exec</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="mo">0o755</span><span class="p">)</span>

            <span class="n">fname_renamed</span> <span class="o">=</span> <span class="n">do_replacements</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">replacement_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="n">fname_renamed</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">fname_renamed</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">dname_renamed</span> <span class="o">=</span> <span class="n">do_replacements</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="n">replacement_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dname</span> <span class="o">!=</span> <span class="n">dname_renamed</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_path</span><span class="p">),</span> <span class="n">dname_renamed</span><span class="p">))</span></div>


<div class="viewcode-block" id="custom_copytree"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.custom_copytree">[docs]</a><span class="k">def</span> <span class="nf">custom_copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom copytree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    src : str</span>
<span class="sd">        Source path to copy from.</span>
<span class="sd">    dst : str</span>
<span class="sd">        Destination path to copy to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

    <span class="n">lst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">custom_copytree</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copy2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span></div>


<div class="viewcode-block" id="generate_docs"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.generate_docs">[docs]</a><span class="k">def</span> <span class="nf">generate_docs</span><span class="p">(</span><span class="n">generate_api_docs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build this application documentation.</span>

<span class="sd">    It executes a bash script instead of directly running the sphinx-apidoc command</span>
<span class="sd">    so the colors of the terminal output are preserved. Infinitely easier to</span>
<span class="sd">    spot build errors this way.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    generate_api_docs : bool</span>
<span class="sd">        If False, do not extract docstrings from Python modules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">generate_api_docs</span><span class="p">:</span>
        <span class="n">commmon_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-M&quot;</span><span class="p">,</span> <span class="s2">&quot;--separate&quot;</span><span class="p">,</span> <span class="s2">&quot;--force&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">]</span>
        <span class="c1"># Ignore modules whose docstrings are a mess and/or are incomplete.</span>
        <span class="n">ignored_modules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;python_modules&quot;</span><span class="p">,</span> <span class="s2">&quot;docopt.py&quot;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;python_modules&quot;</span><span class="p">,</span> <span class="s2">&quot;mistune.py&quot;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;python_modules&quot;</span><span class="p">,</span> <span class="s2">&quot;polib.py&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">call</span><span class="p">([</span><span class="s2">&quot;sphinx-apidoc&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">commmon_args</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;docs_sources&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;modules&quot;</span><span class="p">,</span> <span class="s2">&quot;python_modules&quot;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;python_modules&quot;</span><span class="p">),</span>
        <span class="p">]</span> <span class="o">+</span> <span class="n">ignored_modules</span><span class="p">,</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">root_folder</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">call</span><span class="p">([</span><span class="s2">&quot;sphinx-build&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;coverage&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/CinnamonTools-doctrees&quot;</span><span class="p">,</span> <span class="s2">&quot;./coverage&quot;</span><span class="p">],</span>
             <span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;docs_sources&quot;</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">call</span><span class="p">([</span><span class="s2">&quot;sphinx-build&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/CinnamonTools-doctrees&quot;</span><span class="p">,</span>
              <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">)],</span>
             <span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;docs_sources&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="recursive_glob"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.recursive_glob">[docs]</a><span class="k">def</span> <span class="nf">recursive_glob</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Recursively match files in a directory according to a pattern.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stem : str</span>
<span class="sd">        The directory in which to recourse.</span>
<span class="sd">    file_pattern : str</span>
<span class="sd">        The file name regex pattern to which to match.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matches_list : list</span>
<span class="sd">        A list of file names in the directory that match the file pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">glob</span><span class="p">(</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;/**/&quot;</span> <span class="o">+</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="remove_surplus_files"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.remove_surplus_files">[docs]</a><span class="k">def</span> <span class="nf">remove_surplus_files</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="n">max_files_to_keep</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove surplus files from folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str</span>
<span class="sd">        Path to a folder were to search for files.</span>
<span class="sd">    file_pattern : str</span>
<span class="sd">        The file name pattern to search for.</span>
<span class="sd">    max_files_to_keep : int, optional</span>
<span class="sd">        Maximum amount of files to keep inside the folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recursive_glob</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_files_to_keep</span><span class="p">:</span>
        <span class="n">files_to_delete</span> <span class="o">=</span> <span class="n">all_files</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_files_to_keep</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_to_delete</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="restart_cinnamon"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.restart_cinnamon">[docs]</a><span class="k">def</span> <span class="nf">restart_cinnamon</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Restart Cinnamon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call</span><span class="p">(</span><span class="s2">&quot;nohup cinnamon --replace &gt; /dev/null 2&gt;&amp;1 &amp;&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="split_on_uppercase"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.split_on_uppercase">[docs]</a><span class="k">def</span> <span class="nf">split_on_uppercase</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">keep_contiguous</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split string on uppercase.</span>

<span class="sd">    Based on `an answer &lt;https://stackoverflow.com/a/40382663&gt;`__ from a StackOverflow question.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string : str</span>
<span class="sd">        The string to split by its uppercase characters.</span>
<span class="sd">    keep_contiguous : bool</span>
<span class="sd">        Option to indicate we want to keep contiguous uppercase characters together.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        The parts of the passed string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">string_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">is_lower_around</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">string</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="ow">or</span>
                       <span class="n">string_length</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">string</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">())</span>

    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">string_length</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">keep_contiguous</span> <span class="ow">or</span> <span class="n">is_lower_around</span><span class="p">()):</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">i</span><span class="p">])</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">start</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">parts</span></div>


<div class="viewcode-block" id="BaseXletGenerator"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.BaseXletGenerator">[docs]</a><span class="k">class</span> <span class="nc">BaseXletGenerator</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Base xlet generator.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    base_xlet_path : str</span>
<span class="sd">        Path to the base application (the template).</span>
<span class="sd">    logger : object</span>
<span class="sd">        See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">    new_xlet_destination : str</span>
<span class="sd">        The path to the new generated application.</span>
<span class="sd">    replacement_data : list</span>
<span class="sd">        List of tuples containing (template, replacement) data.</span>
<span class="sd">    xlet_data : dict</span>
<span class="sd">        Storage for xlet data that will be used to generate a base xlet.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        logger : object</span>
<span class="sd">            See &lt;class :any:`LogSystem`&gt;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BaseXletGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="BaseXletGenerator.generate"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.BaseXletGenerator.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_copy</span><span class="p">()</span>
        <span class="n">do_string_substitutions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">replacement_data</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseXletGenerator._do_setup"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.BaseXletGenerator._do_setup">[docs]</a>    <span class="k">def</span> <span class="nf">_do_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do setup.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        SystemExit</span>
<span class="sd">            Halt execution if the destination exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;My Custom Xlet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;My custom xlet description.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_instances&quot;</span><span class="p">:</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">prompt_data_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;applet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;manager&quot;</span><span class="p">:</span> <span class="s2">&quot;appletManager&quot;</span><span class="p">,</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;applet.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metadata.json&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;settings-schema.json&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;z_create_localized_help.py&quot;</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;extension&quot;</span><span class="p">,</span>
                <span class="s2">&quot;manager&quot;</span><span class="p">:</span> <span class="s2">&quot;extensionSystem&quot;</span><span class="p">,</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;extension.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metadata.json&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;z_create_localized_help.py&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter an xlet type:</span><span class="se">\n\n</span><span class="s2">1. applet</span><span class="se">\n</span><span class="s2">2. extension&quot;</span><span class="p">))</span>
        <span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Choose an option&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data_map</span><span class="p">[</span><span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter a name for the xlet:&quot;</span><span class="p">))</span>
        <span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter name&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="c1"># Define these here so I can check for existent destination immediately after the</span>
        <span class="c1"># xlet name is defined and exit if it already exists.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">part</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                                                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_xlet_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span> <span class="s2">&quot;__app__&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;templates&quot;</span><span class="p">,</span> <span class="s2">&quot;BaseXlet&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_folder</span><span class="p">,</span>
                                                 <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ExistentLocation: New xlet cannot be created.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter a description for the xlet:&quot;</span><span class="p">))</span>
        <span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter description&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Ansi</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Enter max instances for the xlet:&quot;</span><span class="p">))</span>
            <span class="n">do_prompt</span><span class="p">(</span><span class="n">prompt_data</span><span class="p">,</span> <span class="s2">&quot;max_instances&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Enter description&quot;</span><span class="p">,</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;max_instances&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;max_instances&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;max_instances&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;manager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data_map</span><span class="p">[</span><span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]][</span><span class="s2">&quot;manager&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data_map</span><span class="p">[</span><span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]][</span><span class="s2">&quot;files&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type_title_case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">replacement_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_NAME$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_DESCRIPTION$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_MANAGER$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;manager&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_TYPE$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;$$XLET_TYPE_TITLE_CASE$$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;type_title_case&quot;</span><span class="p">]),</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="BaseXletGenerator._do_copy"><a class="viewcode-back" href="../../modules/python_modules/python_modules.app_utils.html#python_modules.app_utils.BaseXletGenerator._do_copy">[docs]</a>    <span class="k">def</span> <span class="nf">_do_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Do copy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying files...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlet_data</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]:</span>
            <span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_xlet_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_xlet_destination</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/cinnamon-logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Cinnamon Tools  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2018, Odyseus.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>